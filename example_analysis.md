Example analysis penalized survRRR
================
Marije Sluiskes

# Set up

``` r
set.seed(20)

# libraries
library(mstate)
```

    ## Loading required package: survival

``` r
# functions
source("survRRR_functions.R")
```

    ## Loading required package: glmnet

    ## Loading required package: Matrix

    ## Loaded glmnet 4.1-8

``` r
# data (as generated in create_simulated_dataset.R)
load("simdat.RData")
```

# Prep data in correct format

Format should be the same as for the unpenalized survRRR model (see
documentation `mstate::redrank`). Hence, data object of class `msdata`
is required (see documentation `mstate::msprep`).

## Data parameters

All known from the data set.

``` r
p <- 10 # number of predictors 
k <- 6 # number of outcomes 
n <- nrow(simdat) # number of rows 
```

## From wide to long

``` r
# Transition matrix(k outcomes) 
tmat <- trans.comprisk(k)

# Column names for survival times and event indicators (can be different depending on dataset that is used!)
tnames <- paste("t", 1:k, sep="")
dnames <- paste("d", 1:k, sep="")

# Create dlong
dlong <- data.frame(
  id = rep(simdat$id, each = k),
  Tstart = 0,
  Tstop = c(t(matrix(unlist(c(simdat[, tnames])), n, k))),
  status = c(t(matrix(unlist(c(simdat[, dnames])), n, k))),
  from = 1,
  to = rep(2:(k+1), n),
  trans = rep(1:k, n)
)

#add predictors (can be different depending on dataset that is used!)
predictor_names <- grep("^x", names(simdat), value = TRUE)
# Add each predictor to the dlong data frame
for (predictor in predictor_names) {
  dlong[[predictor]] <- rep(simdat[[predictor]], each = k)
}

# Calculate the time
dlong$time <- dlong$Tstop - dlong$Tstart

# Define the transition matrix and class 
class(dlong) <- c("msdata", "data.frame")
attr(dlong, "trans") <- tmat
```

Multiple rows per individual: one for each outcome.

``` r
head(dlong, n = 10)
```

    ## An object of class 'msdata'
    ## 
    ## Data:
    ##    id Tstart      Tstop status from to trans         x1         x2         x3
    ## 1   1      0 0.78694176      1    1  2     1 -0.9245488 -1.5765366  1.2343686
    ## 2   1      0 0.29620706      1    1  3     2 -0.9245488 -1.5765366  1.2343686
    ## 3   1      0 0.97154288      0    1  4     3 -0.9245488 -1.5765366  1.2343686
    ## 4   1      0 0.97154288      0    1  5     4 -0.9245488 -1.5765366  1.2343686
    ## 5   1      0 0.97154288      0    1  6     5 -0.9245488 -1.5765366  1.2343686
    ## 6   1      0 0.21880656      1    1  7     6 -0.9245488 -1.5765366  1.2343686
    ## 7   2      0 0.27315709      0    1  2     1 -0.6780290  0.7486309 -0.7811259
    ## 8   2      0 0.08805066      1    1  3     2 -0.6780290  0.7486309 -0.7811259
    ## 9   2      0 0.27315709      0    1  4     3 -0.6780290  0.7486309 -0.7811259
    ## 10  2      0 0.15521447      1    1  5     4 -0.6780290  0.7486309 -0.7811259
    ##           x4          x5          x6         x7        x8         x9       x10
    ## 1  1.1709735  1.76062689 -0.09402813  1.2751513 -1.452858 -0.7781864 1.2971222
    ## 2  1.1709735  1.76062689 -0.09402813  1.2751513 -1.452858 -0.7781864 1.2971222
    ## 3  1.1709735  1.76062689 -0.09402813  1.2751513 -1.452858 -0.7781864 1.2971222
    ## 4  1.1709735  1.76062689 -0.09402813  1.2751513 -1.452858 -0.7781864 1.2971222
    ## 5  1.1709735  1.76062689 -0.09402813  1.2751513 -1.452858 -0.7781864 1.2971222
    ## 6  1.1709735  1.76062689 -0.09402813  1.2751513 -1.452858 -0.7781864 1.2971222
    ## 7  0.5601769 -0.03938346 -1.08847850 -0.7758548  1.897775  0.8183071 0.7551879
    ## 8  0.5601769 -0.03938346 -1.08847850 -0.7758548  1.897775  0.8183071 0.7551879
    ## 9  0.5601769 -0.03938346 -1.08847850 -0.7758548  1.897775  0.8183071 0.7551879
    ## 10 0.5601769 -0.03938346 -1.08847850 -0.7758548  1.897775  0.8183071 0.7551879
    ##          time
    ## 1  0.78694176
    ## 2  0.29620706
    ## 3  0.97154288
    ## 4  0.97154288
    ## 5  0.97154288
    ## 6  0.21880656
    ## 7  0.27315709
    ## 8  0.08805066
    ## 9  0.27315709
    ## 10 0.15521447

# Fit penalized survRRR model

Two cases are illustrated here: one where no penalization is included
(for comparison with the unpenalized survRRR model) and one where an
arbitrary level of penalization is included (to illustrate the effect).

## Case 1: no penalization

Penalization is not necessary with such a simple simulated data set as
this one. To be able to compare the estimated Beta matrix with that of
the unpenalized survRRR model (using function `mstate::redrank`), both
penalty parameters are set to 0 here.

``` r
# choose fitted number of ranks 
R2 <- 2 

# choose penalization
lambda_a <- lambda_g <- 0 # penalization Alpha/Gamma matrix, set to 0 for comparison with mstate::redrank later

# choose penalty type (1=lasso, 0=ridge)
my_alpha = 1
```

``` r
# construct formula for the model
predictor_names <- grep("^x", names(dlong), value = TRUE)
formula_str <- paste("Surv(Tstop, status) ~", paste(predictor_names, collapse = " + "))
formula <- as.formula(formula_str)
  
# define Gamma.start (here: randomly initialized)
Gamma.start<- matrix(rnorm(R2*k),R2,k)

# fit the model
pen_mod1 <- pen.survrrr(formula, dat = dlong, R = R2,Gamma.iter = Gamma.start, 
          eps = 1e-5, 
          lambda.alpha = lambda_a, 
          lambda.gamma = lambda_g,  
          standardize.opt = F,
          alpha = my_alpha)
```

    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738834
    ## [1] 0
    ## [1] 0
    ## [1] "present value objective function: 4.73883377708249"
    ## [1] "Delta: 95.2611662229175"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.731153
    ## [1] 0
    ## [1] 0
    ## [1] "present value objective function: 4.73115260043352"
    ## [1] "Delta: 0.0076811766489655"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.73114
    ## [1] 0
    ## [1] 0
    ## [1] "present value objective function: 4.73114010109253"
    ## [1] "Delta: 1.24993409853502e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.73114
    ## [1] 0
    ## [1] 0
    ## [1] "present value objective function: 4.73114004078816"
    ## [1] "Delta: 6.0304372162534e-08"

Comparison with unpenalized model:

``` r
# fit the model
unpen_mod1 <- redrank(formula, dat = dlong, R = R2,Gamma.start = Gamma.start, 
          eps = 1e-5)
```

    ## 
    ## 
    ## Iteration 1 ... 
    ## 
    ## Alpha = -0.17266 -0.14292 -0.22461 -0.015 -0.0404 -0.12413 -0.06924 -0.08202 -0.11171 -0.02678 -0.48166 -0.48881 -0.34887 -0.11074 -0.45212 -0.1791 -0.29906 -0.14704 -0.48458 -0.0497
    ## Gamma =  1.63556 -1.33279 0.84123 -1.10729 -3.0308 -0.46348 -3.51903 -0.64232 2.26258 -2.15274 -1.66204 -1.22955
    ## Previous loglik = 100 , present loglik = -15253.91  Delta =  15353.91
    ## 
    ## Iteration 2 ... 
    ## 
    ## Alpha = -0.18189 -0.15187 -0.21872 -0.02066 -0.03373 -0.11475 -0.09508 -0.11331 -0.09435 -0.04786 -0.5004 -0.49747 -0.33166 -0.14321 -0.44135 -0.18392 -0.31492 -0.19733 -0.46869 -0.06903
    ## Gamma =  1.59914 -1.32496 0.77093 -1.0799 -3.18416 -0.43628 -3.33638 -0.6534 2.31775 -2.16347 -1.73047 -1.24579
    ## Previous loglik = -15253.91 , present loglik = -14194.16  Delta =  -1059.754
    ## 
    ## Iteration 3 ... 
    ## 
    ## Alpha = -0.18215 -0.15194 -0.21765 -0.02088 -0.03353 -0.11458 -0.09611 -0.11489 -0.09366 -0.04845 -0.5002 -0.4976 -0.3315 -0.14349 -0.44145 -0.18412 -0.31477 -0.19812 -0.46864 -0.06908
    ## Gamma =  1.59708 -1.32417 0.76783 -1.07878 -3.19261 -0.43446 -3.324 -0.65544 2.3216 -2.16484 -1.73699 -1.24495
    ## Previous loglik = -14194.16 , present loglik = -14193.41  Delta =  -0.7467757
    ## 
    ## Iteration 4 ... 
    ## 
    ## Alpha = -0.18217 -0.15194 -0.21759 -0.0209 -0.03353 -0.11457 -0.09616 -0.11498 -0.09361 -0.04848 -0.50019 -0.49761 -0.33151 -0.14347 -0.44144 -0.18414 -0.31475 -0.19811 -0.46867 -0.06906
    ## Gamma =  1.59687 -1.32408 0.76768 -1.07872 -3.19312 -0.43435 -3.32317 -0.65562 2.32192 -2.16497 -1.73751 -1.24483
    ## Previous loglik = -14193.41 , present loglik = -14193.41  Delta =  -0.00217337
    ## 
    ## Iteration 5 ... 
    ## 
    ## Alpha = -0.18217 -0.15194 -0.21759 -0.0209 -0.03352 -0.11457 -0.09616 -0.11499 -0.09361 -0.04849 -0.50018 -0.49761 -0.33151 -0.14347 -0.44144 -0.18414 -0.31475 -0.19811 -0.46867 -0.06906
    ## Gamma =  1.59685 -1.32407 0.76768 -1.07872 -3.19316 -0.43434 -3.32311 -0.65563 2.32194 -2.16498 -1.73755 -1.24482
    ## Previous loglik = -14193.41 , present loglik = -14193.41  Delta =  -9.68e-06

Estimated Beta matrix penalized survRRR function (without penalization):

``` r
pen_mod1$Alpha %*% pen_mod1$Gamma
```

    ##             [,1]       [,2]      [,3]      [,4]       [,5]      [,6]
    ##  [1,] 0.37141423 0.39974186 0.7984974 0.9313008 0.65945752 0.9367700
    ##  [2,] 0.41623881 0.42012142 0.7007463 0.8291224 0.72382436 0.8808448
    ##  [3,] 0.09149962 0.19059473 0.8384619 0.9388013 0.21277901 0.7894199
    ##  [4,] 0.15656259 0.13868566 0.1288588 0.1629502 0.26169372 0.2140462
    ##  [5,] 0.53096062 0.45045646 0.2985299 0.3995546 0.87664068 0.6053641
    ##  [6,] 0.06082426 0.11063856 0.4454878 0.5003994 0.13267234 0.4273754
    ##  [7,] 0.26322346 0.26572797 0.4434847 0.5247041 0.45776303 0.5573320
    ##  [8,] 0.07864745 0.12537192 0.4528094 0.5108277 0.16188759 0.4453463
    ##  [9,] 0.47105224 0.43370342 0.5022166 0.6168549 0.79634100 0.7436914
    ## [10,] 0.01401162 0.03729842 0.1849106 0.2062310 0.03701471 0.1700821

Estimated Beta matrix unpenalized survRRR function:

``` r
unpen_mod1$Alpha %*% unpen_mod1$Gamma
```

    ##     eventfree -> cause1 eventfree -> cause2 eventfree -> cause3
    ## x1           0.37138087          0.39970972           0.7989508
    ## x2           0.41624688          0.42014113           0.7013041
    ## x3           0.09149008          0.19056897           0.8387720
    ## x4           0.15659469          0.13872197           0.1290482
    ## x5           0.53097039          0.45045806           0.2987871
    ## x6           0.06087013          0.11068580           0.4458082
    ## x7           0.26319172          0.26570189           0.4437661
    ## x8           0.07868718          0.12542681           0.4532246
    ## x9           0.47107301          0.43370169           0.5024749
    ## x10          0.01401205          0.03727151           0.1848157
    ##     eventfree -> cause4 eventfree -> cause5 eventfree -> cause6
    ## x1            0.9333096          0.65989948           0.9391712
    ## x2            0.8311650          0.72452150           0.8834422
    ## x3            0.9404071          0.21248861           0.7907342
    ## x4            0.1635126          0.26208775           0.2149089
    ## x5            0.4008301          0.87787655           0.6077703
    ## x6            0.5014447          0.13264414           0.4282868
    ## x7            0.5259124          0.45813882           0.5588886
    ## x8            0.5120066          0.16189892           0.4464071
    ## x9            0.6183512          0.79730664           0.7460640
    ## x10           0.2063980          0.03692588           0.1702090

The two Beta estimates are virtually identical, as should be.

## Case 2: no penalization

The penalty parameters (`lambda_a` and `lambda_g`) are chosen ad hoc
here, for illustration purposes. In reality, they should be tuned using
e.g. cross-validation.

``` r
# choose fitted number of ranks 
R2 <- 2 

# choose penalization
lambda_a <- lambda_g <- 0.005 # penalization Alpha/Gamma matrix

# choose penalty type (1=lasso, 0=ridge)
my_alpha = 1
```

``` r
# construct formula for the model
predictor_names <- grep("^x", names(dlong), value = TRUE)
formula_str <- paste("Surv(Tstop, status) ~", paste(predictor_names, collapse = " + "))
formula <- as.formula(formula_str)
  
# define Gamma.start (here: randomly initialized )
Gamma.start <- matrix(rnorm(R2*k),R2,k)

# fit the model
pen_mod2 <- pen.survrrr(formula, dat = dlong, R = R2,Gamma.iter = Gamma.start, 
          eps = 1e-5, 
          lambda.alpha = lambda_a, 
          lambda.gamma = lambda_g,  
          standardize.opt = F,
          alpha = my_alpha)
```

    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.836593
    ## [1] 0.009886355
    ## [1] 0.05597838
    ## [1] "present value objective function: 4.90245787528751"
    ## [1] "Delta: 95.0975421247125"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.769291
    ## [1] 0.01476141
    ## [1] 0.05637912
    ## [1] "present value objective function: 4.84043185346688"
    ## [1] "Delta: 0.0620260218206319"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.746032
    ## [1] 0.02068792
    ## [1] 0.05398302
    ## [1] "present value objective function: 4.82070334960543"
    ## [1] "Delta: 0.0197285038614483"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.742437
    ## [1] 0.02299364
    ## [1] 0.05067111
    ## [1] "present value objective function: 4.81610187917426"
    ## [1] "Delta: 0.00460147043116432"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.741676
    ## [1] 0.02415606
    ## [1] 0.04797199
    ## [1] "present value objective function: 4.81380394559316"
    ## [1] "Delta: 0.00229793358110708"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.74128
    ## [1] 0.02506959
    ## [1] 0.04577505
    ## [1] "present value objective function: 4.81212427590099"
    ## [1] "Delta: 0.00167966969217126"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.740943
    ## [1] 0.02588386
    ## [1] 0.04395615
    ## [1] "present value objective function: 4.81078291524971"
    ## [1] "Delta: 0.00134136065127599"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.740573
    ## [1] 0.02665078
    ## [1] 0.04243592
    ## [1] "present value objective function: 4.80965935845443"
    ## [1] "Delta: 0.00112355679527631"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.740289
    ## [1] 0.0273239
    ## [1] 0.04114158
    ## [1] "present value objective function: 4.80875484876388"
    ## [1] "Delta: 0.000904509690550448"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.740071
    ## [1] 0.02792166
    ## [1] 0.04002161
    ## [1] "present value objective function: 4.8080143182584"
    ## [1] "Delta: 0.000740530505484394"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.739906
    ## [1] 0.02845445
    ## [1] 0.03903801
    ## [1] "present value objective function: 4.8073983699311"
    ## [1] "Delta: 0.000615948327300941"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.739704
    ## [1] 0.0289285
    ## [1] 0.03820522
    ## [1] "present value objective function: 4.80683775903093"
    ## [1] "Delta: 0.000560610900167902"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.739362
    ## [1] 0.02936233
    ## [1] 0.03757949
    ## [1] "present value objective function: 4.80630368742707"
    ## [1] "Delta: 0.000534071603862429"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.739111
    ## [1] 0.02977831
    ## [1] 0.03702964
    ## [1] "present value objective function: 4.8059188840278"
    ## [1] "Delta: 0.000384803399271938"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738964
    ## [1] 0.03013862
    ## [1] 0.03655268
    ## [1] "present value objective function: 4.80565552263617"
    ## [1] "Delta: 0.000263361391626304"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.73888
    ## [1] 0.03045198
    ## [1] 0.03613988
    ## [1] "present value objective function: 4.80547194055682"
    ## [1] "Delta: 0.00018358207935254"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738832
    ## [1] 0.03072709
    ## [1] 0.03578191
    ## [1] "present value objective function: 4.80534121786098"
    ## [1] "Delta: 0.000130722695836027"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738805
    ## [1] 0.03097076
    ## [1] 0.03547037
    ## [1] "present value objective function: 4.80524622123448"
    ## [1] "Delta: 9.49966264984781e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.73879
    ## [1] 0.03118804
    ## [1] 0.03519816
    ## [1] "present value objective function: 4.80517590714311"
    ## [1] "Delta: 7.03140913707045e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738781
    ## [1] 0.03138267
    ## [1] 0.03495951
    ## [1] "present value objective function: 4.80512302167787"
    ## [1] "Delta: 5.28854652408484e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738754
    ## [1] 0.031566
    ## [1] 0.03475165
    ## [1] "present value objective function: 4.80507166481586"
    ## [1] "Delta: 5.13568620066351e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738719
    ## [1] 0.0317346
    ## [1] 0.0345704
    ## [1] "present value objective function: 4.80502389405007"
    ## [1] "Delta: 4.77707657946524e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738689
    ## [1] 0.03188457
    ## [1] 0.03441117
    ## [1] "present value objective function: 4.80498483827494"
    ## [1] "Delta: 3.90557751313025e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738664
    ## [1] 0.03201827
    ## [1] 0.03427065
    ## [1] "present value objective function: 4.80495299066437"
    ## [1] "Delta: 3.18476105674037e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738643
    ## [1] 0.03213763
    ## [1] 0.03414624
    ## [1] "present value objective function: 4.80492708504802"
    ## [1] "Delta: 2.59056163551818e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738626
    ## [1] 0.03224428
    ## [1] 0.03403585
    ## [1] "present value objective function: 4.80490604533641"
    ## [1] "Delta: 2.10397116022776e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738612
    ## [1] 0.03233962
    ## [1] 0.03393775
    ## [1] "present value objective function: 4.8048889731261"
    ## [1] "Delta: 1.70722103138843e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.7386
    ## [1] 0.03242487
    ## [1] 0.03385046
    ## [1] "present value objective function: 4.8048751276355"
    ## [1] "Delta: 1.38454905957985e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.73859
    ## [1] 0.0325011
    ## [1] 0.03377275
    ## [1] "present value objective function: 4.80486390248948"
    ## [1] "Delta: 1.12251460260282e-05"
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ##   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%
    ## [1] 4.738582
    ## [1] 0.03256926
    ## [1] 0.03370351
    ## [1] "present value objective function: 4.80485480342409"
    ## [1] "Delta: 9.09906538737459e-06"

Check estimated matrices:

``` r
pen_mod2$Alpha
```

    ##              [,1]      [,2]
    ##  [1,]  0.00000000 0.7791366
    ##  [2,] -0.02194542 0.7308092
    ##  [3,]  0.46445651 0.6625523
    ##  [4,] -0.07697960 0.1643583
    ##  [5,] -0.58747060 0.4880763
    ##  [6,]  0.17613658 0.3454684
    ##  [7,]  0.00000000 0.4602623
    ##  [8,]  0.14483151 0.3546847
    ##  [9,] -0.30141476 0.6121957
    ## [10,]  0.01924730 0.1238259

``` r
pen_mod2$Gamma 
```

    ##            [,1]       [,2]      [,3]      [,4]       [,5]     [,6]
    ## [1,] -0.3975347 -0.2340860 0.2410848 0.2321732 -0.6649596 0.000000
    ## [2,]  0.4656559  0.4964265 0.9376714 1.1105772  0.8190196 1.141514

``` r
pen_mod2$Alpha %*% pen_mod2$Gamma
```

    ##             [,1]       [,2]      [,3]      [,4]       [,5]      [,6]
    ##  [1,] 0.36280955 0.38678410 0.7305742 0.8652914 0.63812819 0.8893951
    ##  [2,] 0.34902965 0.36793017 0.6799682 0.8065249 0.61313986 0.8342286
    ##  [3,] 0.12388379 0.22018578 0.7332297 0.8436498 0.23379849 0.7563124
    ##  [4,] 0.10713648 0.09961167 0.1355555 0.1646600 0.18580101 0.1876173
    ##  [5,] 0.46081554 0.37981266 0.3160250 0.4056516 0.79038830 0.5571458
    ##  [6,] 0.09084901 0.13026860 0.3663997 0.4245636 0.16582172 0.3943569
    ##  [7,] 0.21432383 0.22848640 0.4315748 0.5111568 0.37696383 0.5253957
    ##  [8,] 0.10758549 0.14217189 0.3674944 0.4275308 0.19418666 0.4048775
    ##  [9,] 0.40489536 0.37446717 0.5013719 0.6099102 0.70182895 0.6988298
    ## [10,] 0.05000879 0.05696494 0.1207482 0.1419869 0.08861717 0.1413490

Some sparsity can be observed. If lambda’s are slightly higher, a rank 1
model will be fitted, even though a rank 2 model is specified (i.e. one
column of Alpha and Gamma will be fully zero).
